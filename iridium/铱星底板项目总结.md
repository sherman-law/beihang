## 铱星底板项目总结
### 关于本文档
本文档是针对在2017.12~2018.1时间段内做的铱星底板项目的过程中遇到的问题记录和项目总结。

### 过程记录
#### 前期准备
* 在项目的开始阶段，主要是针对需求文档进行分析并分配任务。
* 定义协议数据帧。
* 针对需求文档设计自己负责模块的程序设计，开始阶段主要都是在熟悉需求。
* 项目分为：队列、铱星模块收发、485总线收发、传感器数据获取、心跳、轮询、重启机制。

#### 透传功能程序编写并整合
* 整合并测试透传功能（铱星模块收发，485总线收发），使用串口助手检测485总线，使用铱星模块作为地面站。
* 合并传感器代码

#### 与相机和能源控制器联合调试
* 一开始没有使用合并好的代码，调试起来相当混乱（**问题：应该使用整合好的分支进行测试**）。
* 使用合并好的代码，发现代码若干BUG并修复，主要是串口DMA发送一些变量溢出的问题。
* 与能源控制器联合调试的过程中，发现485串口有发送，但是能源控制器没有接收到数据。（**问题：串口波特率即使配置成是一样的也无法通信，MCU外部高速晶振，HAL库默认是24MHz，我们使用了25MHz**）
* 即使晶振修正了之后，还是通信失败（**问题：能源控制器在一段时间没有收到总线数据，会自动关闭DMA**）
* 总线有干扰信号（**问题：在不发送数据的时候，485的发送使能引脚不应该使能，使能会占用总线，两个485同时占用总线就会产生干扰信号**）    

#### 加上心跳和重启功能测试
* 经过一个晚上的测试，发现心跳计数没有自加，但是数据心跳数据是可以正常下传到地面站的（**问题：在铱星没有接受到数据超过半个小时，就会触发重启。需要地面站也定时发送心跳帧**）
* 重启应该使用硬件复位重启

#### 整合测试（透传，心跳，重启，轮询）
* 发现使用串口DMA发送数据的时候，485任务执行的过程中，如果3个FIFO都有数据，由于串口DMA底层驱动不支持连续发送，因此，在发送完一帧数据后，马上进行第二帧的发送，就会出现数据帧丢失的情况（**问题：串口DMA不支持连续发送，使用阻塞形式发送数据，串口DMA连续发送问题有待解决**）
* 在压力测试的过程中，发现铱星底板会有重启失败现象（**问题：在重启之前，关闭铱星的操作，有可能检测不到铱星模块返回得OK，让重启任务中的while循环无法跳出，因此，这里不应该使用while循环去阻塞等待铱星状态的返回，并且，为什么处理不到铱星模块返回的OK还有待解决。**）


### 总结
#### git版本库的使用
在多人协作开发的过程中，更是需要明确的分工，和规范的代码管理，才可以提高开发效率。由个人经验总结如下：
1. 在项目都分工好之后，每个人都有各自负责的模块。那么，项目主仓库上面应该有相对应的模块（或者成员）的开发分支（sherman_dev或者485bus_dev）。
2. 在项目的各个模块的开发分支（sherman_dev或者485bus_dev）上面，模块负责人在上面编写和调试代码自己负责的模块的代码。
3. 在合并代码的时候，应该有一个*integration-dev*的分支，在上面整合并测试合并之后的代码，如果，在测试过程中发现bug，但是又害怕影响主要的代码功能，就checkout出一个*integration-debug*分支（临时分支），用以修复bug，在修复完bug之后就马上清除debug分支（删除临时分支）。
4. 需要长时间开发测试某个特性的话，就checkout出一条feature分支，在上面去做测试。
5. 协作开发，关键是提交代码的时候一定要保证代码是能**正确编译，功能正常**，且不影响别人的代码。
6. 功能齐全并且测试充分之后，就往master分支上面合并，在master分支上面就是release版本的代码了。

#### 编程习惯
在编写代码的过程中，应该养成良好的编程习惯。
* 每一条判断语句，都应该包含所有情况的处理。
* 在使用while循环的时候，需要特别小心是否会造成死循环。
* 在使用底层提供的函数的时候，如果有返回值，就需要根据返回值，打印调试信息。（**特别是异常状态的信息打印**）
